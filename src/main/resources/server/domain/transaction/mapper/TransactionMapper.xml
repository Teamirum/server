<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="server.domain.transaction.mapper.TransactionMapper">

    <!-- Result Mapping with Enum TypeHandler -->
    <resultMap id="TransactionResultMap" type="server.domain.transaction.domain.Transaction">
        <id property="idx" column="idx" />
        <result property="memberIdx" column="member_idx" />
        <result property="creditIdx" column="credit_idx" />
        <result property="accountIdx" column="account_idx" />
        <result property="time" column="time" />
        <result property="payMethod" column="pay_method" />
        <result property="amount" column="amount" />
        <result property="memo" column="memo" />
        <result property="category" column="category" />
        <result property="tranId" column="tran_id" />
    </resultMap>

    <!-- Insert Transaction -->
    <insert id="save" parameterType="server.domain.transaction.domain.Transaction">
        INSERT INTO Transaction (
            member_idx, credit_idx, account_idx, time, pay_method, amount, memo, category, tran_id
        ) VALUES (
                     #{memberIdx}, #{creditIdx}, #{accountIdx}, #{time}, #{payMethod}, #{amount}, #{memo}, #{category}, #{tranId}
                 )
    </insert>

    <!-- Select Transaction by TransactionIdx -->
    <select id="findByTransactionIdx" parameterType="Long" resultMap="TransactionResultMap">
        SELECT *
        FROM Transaction
        WHERE idx = #{idx}
    </select>

    <!-- Select all Transactions by CreditIdx -->
    <select id="findTransactionsByCreditIdx" parameterType="Long" resultMap="TransactionResultMap">
        SELECT *
        FROM Transaction
        WHERE credit_idx = #{creditIdx}
    </select>

    <!-- Select all Transactions by MemberIdx -->
    <select id="findAllByMemberIdx" parameterType="Long" resultMap="TransactionResultMap">
        SELECT *
        FROM Transaction
        WHERE member_idx = #{memberIdx} ORDER BY idx DESC
    </select>

    <!-- Update Transaction -->
    <update id="updateTransaction" parameterType="map">
        UPDATE Transaction
        SET amount = #{amount}, memo = #{memo}, category = #{category}, pay_method = #{payMethod}, time = #{time}
        WHERE idx = #{idx}
    </update>

    <!-- Delete Transaction -->
    <delete id="delete" parameterType="Long">
        DELETE FROM Transaction
        WHERE idx = #{idx}
    </delete>

    <select id="findByIdxAndMemberIdx" parameterType="map" resultMap="TransactionResultMap">
        SELECT *
        FROM Transaction
        WHERE idx = #{idx} AND member_idx = #{memberIdx}
    </select>

</mapper>
